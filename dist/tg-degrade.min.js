TG={},TG.HOST="localhost"==location.hostname?{USER:"localhost:8064",WENDA:"localhost:8175"}:{USER:"user.tgnet.com",WENDA:"wd.tgnet.com"};var checkTest=function(){for(var a=arguments.length-1,b=$.trim(arguments[a]),c=!0,d=0;a>d&&("regexp"==$.type(arguments[d])?c=arguments[d].test(b):$.isFunction(arguments[d])&&(c=arguments[d](b)),c);d++);return c};$.extend(TG,{check:function(a,b){return arguments.callee.condition[b]?checkTest.apply(this,arguments.callee.condition[b].concat([a])):!!a.match(b)}}),TG.check.condition={mobile:[/^\d{8,20}$/],email:[/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/i],url:[/^(http(s)?:\/\/)?([\w-]+\.)+[\w-]+(\/[\w\- .\/?%&=]*)?$/],tel:[/^[\d\-()]{6,20}$/],qq:[/^\d{5,16}$/],cin:[function(){var a=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2,1],b=[1,0,10,9,8,7,6,5,4,3,2],c=function(a){if(a=$.trim(a),15==a.length)return f(a);if(18==a.length){var b=a.split("");return e(a)&&d(b)}return!1},d=function(c){var d=0;"x"==c[17].toLowerCase()&&(c[17]=10);for(var e=0;17>e;e++)d+=a[e]*c[e];var f=d%11;return c[17]==b[f]},e=function(a){var b=a.substring(6,10),c=a.substring(10,12),d=a.substring(12,14),e=new Date(b,parseFloat(c)-1,parseFloat(d));return!(e.getFullYear()!=parseFloat(b)||e.getMonth()!=parseFloat(c)-1||e.getDate()!=parseFloat(d))},f=function(a){var b=a.substring(6,8),c=a.substring(8,10),d=a.substring(10,12),e=new Date(b,parseFloat(c)-1,parseFloat(d));return!(e.getYear()!=parseFloat(b)||e.getMonth()!=parseFloat(c)-1||e.getDate()!=parseFloat(d))};return c}()]},TG.Page={},function(){function a(a,b){$.isString(a)&&(a=a.split(b));var c=a.shift();return c=1==c?0:0==c?999:c,0!=c&&a[0].indexOf("登录")>=0&&(c=1),0==c?{Data:a,State:c}:{Msg:a[0],State:c}}function b(a){return a===!0&&(a=1/0),function(b){var c=b.State,d=$.Deferred();return 1==c&&this._retry<a?TG.Page.login?TG.Page.login(b).done(function(){d.resolve()}):d.resolve():d.reject(),d}}var c=function d(a,c){return this instanceof d?(this.settings=$.extend({},d.defaults),"object"==typeof a?$.extend(this.settings,a):this.settings.url=a,"boolean"==typeof c&&(c={obstruction:c}),$.extend(this.settings,c),(this.settings.retune===!0||"number"==typeof this.settings.retune)&&(this.settings.retune=b(this.settings.retune)),this._ajax=null,void(this.url=this.settings.url)):new d(a,c)};c.Spy=function(a,b,d){if("number"==typeof b&&(d=b,b=null),!(this instanceof c.Spy))return new c.Spy(a,b,d);var e,f;((f=null==b)||"function"!=typeof b)&&(e=b,b=function(){var a=$.Deferred();return setTimeout(function(){f?a.reject(e):a.resolve(e)},d||c.Spy.defaults.delay),a}),this.dataFactory=b,c.spies[a]=this},c.Spy.prototype={ajax:function(a){var b=a.data;$.isArrayLike(b)&&(b=$.serializeNodes(b,","));var c=$.now();return console.groupCollapsed("%c发送了一个TG.JSONGetter.Spy请求至 %s","color:#00F",a.url),console.log("请求数据 %O",b),console.groupEnd(),$.when(this.dataFactory(b,a)).done(function(b){console.groupCollapsed("%c返回了一个TG.JSONGetter.Spy响应从 %s","color:#00F",a.url),console.log("耗时约 %i ms",$.now()-c),console.log("响应数据 %O",b),console.groupEnd()}).fail(function(){console.groupCollapsed("%c返回了一个TG.JSONGetter.Spy响应从 %s","color:#F00",a.url),console.log("耗时约 %i ms",$.now()-c),console.groupEnd()}).done(a.success).fail(a.error).promise()},destroy:function(){delete c.spies[this.url]}},c.spies={},c.Spy.defaults={delay:1e3},c.debug=!0,c.defaults={spy:{},obstruction:!0,retune:!1,success:$.noop,error:$.noop,complete:$.noop},c.config=function(a){$.extend(c.defaults,a)},c.prototype={send:function(b){var d,e=this,f=$.Deferred();if(this.retry?this._retry++:(f.fail(this.settings.error).done(this.settings.success).always(this.settings.complete),this._retry=0),!this.retry&&this.settings.obstruction&&this._ajax&&"pending"==this._ajax.state())e.branchAjaxResult(f,{State:-1e3});else{var g={};this.settings.beforeSend&&!1===this.settings.beforeSend(b,g)?($.extend(g,{State:-500,Msg:"由于需求请求被中断"}),e.branchAjaxResult(f,g)):(d={url:e.settings.url,type:"post",dataType:"text",data:e._sendData=b,contentType:"application/x-www-form-urlencoded;charset=utf-8",error:function(a,b){e.branchAjaxResult(f,{State:e.handleError(b)})},success:function(b){var c=0;if(b=b||{State:-201},"string"==typeof b)try{b=$.parseJSON(b)}catch(d){c=1}!c&&"object"==typeof b&&("state_code"in b||"message"in b)?b={State:parseInt(b.state_code),Data:b.data,Msg:b.message,HelpLink:b.help_link}:!c&&"object"==typeof b&&("State"in b||"Data"in b)||(b=c&&":"==b.charAt(1)||$.isArray(b)&&"number"==typeof b[0]?a(b,":"):{State:0,Data:b}),e.branchAjaxResult(f,$.extend(g,b))},timeout:this.settings.timeout},this._ajax=c.debug&&c.spies[e.url]?c.spies[e.url].ajax(d):$.ajax(d))}return f.promise()},branchAjaxResult:function(a,b){var c=this,d=b.State,e=[this._originData=b,this._data=b.Data,this._state=b.State,this._msg=b.Msg];d?-999>d?a.notifyWith(this,e):(e[3]=e[3]||"系统错误",this.settings.retune?(e[0].retry=!0,a.notifyWith(this,e),$.when(this.settings.retune.apply(this,e)).done(function(){c.retry=!0,c.send(c._sendData).done(function(){a.resolveWith(c,arguments)}).fail(function(){a.rejectWith(c,arguments)}).progress(function(){a.notifyWith(c,arguments)})}).fail(function(){c.retry=!1,a.rejectWith(this,e)})):a.rejectWith(this,e)):a.resolveWith(this,e)},handleError:function(a){var b=0;switch(a){case"error":b=-100;break;case"parseerror":b=-200;case"abort":b=-101;break;case"timeout":b=-102;break;default:b=-999}return b},spy:function(a,b){return c.Spy(this.url,a,b),this}},c.defaultErrHandler=function(a){var b=a.Msg||"系统错误";alert(a.State>0||a.State<-499?b:"(错误码："+a.State+")"+b+"\n请稍候重试或联系客服!")},TG.JSONGetter=c}(),$.fn.ajaxBind=function(a,b,c,d){b instanceof TG.JSONGetter||"string"==typeof b||(d=c,c=b,b=a,a=null);var e=$.extend({data:c},$.fn.ajaxBind.defaults);"string"==typeof b?e.request=TG.JSONGetter(b,{error:$.noop}):b instanceof TG.JSONGetter?e.request=b:$.extend(e,b),"function"==typeof d&&(d={success:d}),$.extend(e,d);var f,g=["click"];return a&&g.push(a),g.push(function(a){var b,c,d,g,h="INPUT"==this.tagName?"val":"html",i=this,j=$(this),k="function"==typeof e.data?e.data.call(i,e.request):e.data;if($.isArrayLike(k)&&(k=$.serializeNodes(k,",")),null!=k){if(d=j[h](),b=j.children(),c=j.text(),g={State:-501},e.beforeSend.call(this,a,k,g,b,c)===!1)return e.complete.call(i,g,k,e.request,d,b,c),void(g.State?g.State>=-999&&e.error.call(i,g,e.request):e.success.call(i,g,k,e.request));f=e.request.send(k),f.always(function(){$.extend(g,arguments[0]),e.complete.call(i,g,k,e.request,d,b,c)}).done(function(){e.success.call(i,g,k,e.request)}).fail(function(){e.error.call(i,g,k,e.request)})}}),this.on.apply(this,g)},$.fn.ajaxBind.defaults={complete:function(){$(this).removeClass("disabled").removeAttr("disbaled").removeAttr("disabled")},beforeSend:function(){$(this).addClass("disabled").prop("disabled",!0)},error:TG.JSONGetter.defaultErrHandler,success:$.noop},TG.User={login:function(a,b,c,d){var e=$.Deferred();return $.ajax($.extend({data:{u:a,p:b,r:null==c?0:1},url:"http://"+TG.HOST.USER+"/AjaxHandler.ashx?op=login",type:"post",dataType:"jsonp",timeout:5e3,error:function(a,b){var c;switch(b){case"timeout":c={State:-1,Msg:"登录超时，请重试。"};break;default:c={State:-2,Msg:"登录数据异常，请重试。"}}e.reject(c)}},d)).done(function(a){a?e.resolve(a):(a={State:-2,Msg:""},e.reject(a))}),e.always(function(a){0==a.State&&TG.User.Data.set($.extend({LoginState:1},a.Data))})},logout:function(a){var b=$.Deferred();return $.ajax($.extend({url:"http://"+TG.HOST.USER+"/System/AjaxHandler.ashx?op=logout",dataType:"jsonp",timeout:5e3,error:function(a,c){var d;switch(c){case"timeout":d={State:-1,Msg:"注销超时"};break;default:d={State:-2,Msg:"注销失败，请重试。"}}b.resolve(d)}},a)).done(function(a){a||(a={State:-2,Msg:""}),b.resolve(a)}),b.always(function(a){0==a.State&&TG.User.Data.set($.extend({LoginState:0},a.Data))}),b}},function(a){function b(a){return JSON.stringify(a)}function c(a){var b;"string"!=typeof a&&(b=a);try{b=JSON.parse(a)}catch(c){}return $.isPlainObject(b)||(b={}),b}var d=c(localStorage.getItem(a));TG.User.Data=$.EventEmitter($.mix(function(a){return $.mix(a,d)},{userTicker:!1,get:function(a){return a?d[a]:$.extend({},d)},init:function(){var a=this._callback.bind(this);"onstorage"in document?document.attachEvent("onstorage",a):$.support.localStorage?window.addEventListener("storage",a):this.userTicker||window.attachEvent("onfocus",a),this.init=$.noop},_callback:function(b){var d=this;$.nextTick(function(){if(b=b||window.storageEvent,!b.key||a==b.key){var e=d._testAndSet(c(b.newValue||localStorage.getItem(a)));d._isChange(e)&&d.trigger("change",e)}})},set:function(c,d){var e,f=!0;"string"==$.type(c)&&(e=c,c={},c[e]=d,f=!1);var g=this._testAndSet(c,f);this._isChange(g)&&(this.trigger("change",g),$.nextTick(function(){localStorage.setItem(a,b(g[2]))}))},_isChange:function(a){return!$.isEmptyObject(a[0])||!$.isEmptyObject(a[1])},_testAndSet:function(a,b){var c,e,f={},g={};e=b?$.mix({},a,d):a;for(c in e)e.hasOwnProperty(c)&&!$.isEqual(d[c],a[c])&&(g[c]=d[c],a.hasOwnProperty(c)?d[c]=f[c]=a[c]:delete d[c]);return[f,g,d]}}))}("tguserdata"),TG.User.Data.init(),$.fn.ellipsis=function(){function a(a,b,c){if(!(a.height()<=b))for(var d,e=!1,f=this.contents(),g=f.length-2;g>-1&&a.height()>b;g--)if(d=f[g],"3"==d.nodeType){e||(e=!!$(d).after(c));for(var h=d.nodeValue.replace(/ {2,}/," ");d.nodeValue&&a.height()>b;)h=h.substr(0,h.length-1),d.nodeValue=h}}return function(){return this.each(function(){var b,c=c,d=d||'<span class="ellipsis">...</span>';c=c||this;var e=window.getComputedStyle?getComputedStyle(c)["max-height"]||getComputedStyle(c).maxHeight:c.currentStyle["max-height"],f=e.match(/(0?\.?\d*)px$/);if(f){e=b=f[1];var g=$("<span></span>",{html:"o",css:{position:"absolute",whiteSpace:"nowrap",left:"-999em"}}).appendTo(this),h=g.height();g.remove();var i=Math.floor(e/h);e=i*h,c.style.maxHeight="none",c.style.overflowY="auto",c.style.height="auto","webkitLineClamp"in this.style?(c.style.textOverflow="ellipsis",c.style.display="-webkit-box",c.style.webkitBoxOrient="vertical",c.style.webkitLineClamp=i):a.call($(this),$(c),e,d),c.style.overflowY="hidden",c.style.maxHeight=b+"px"}})}}(),TG.Event=function(a){var b=$.EventEmitter(a);return b.bind=b.on,b.unbind=b.off,b},TG.JSON={parse:function(a){if("string"!=typeof a)return a;try{return jQuery.parseJSON(a)}catch(b){return void 0}},stringify:JSON.stringify},TG.Timer=function(a,b){b=b||1;var c=$.Timer(!0,a,b);c.bind=function(a){this.on("tick",a)},c.unbind=function(){this.off("tick")},c.runNum=function(a){return void 0===a?this.tickNum:void(this.tickNum=Math.max(0,parseInt(a)))}},function(){window._=function(){},$.extend(_,{size:$.Object.size,reduce:$.Object.reduce,type:$.type,argsFormat:function(a,b){var c=arguments.callee.caller.arguments;return c=$.argsArrange(c,a,b),c.callee=arguments.callee,c}});var a=function(){for(var a=arguments.length-1,b=$.trim(arguments[a]),c=!0,d=0;a>d&&("regexp"==$.type(arguments[d])?c=arguments[d].test(b):$.isFunction(arguments[d])&&(c=arguments[d](b)),c);d++);return c};$.extend(_,{check:function(b,c){return arguments.callee.condition[c]?a.apply(this,arguments.callee.condition[c].concat([b])):!!b.match(c)}}),_.check.condition={mobile:[/^\d{8,20}$/],email:[/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/i],url:[/^(http(s)?:\/\/)?([\w-]+\.)+[\w-]+(\/[\w\- .\/?%&=]*)?$/],tel:[/^[\d\-()]{6,20}$/],qq:[/^\d{5,16}$/],cin:[function(){var a=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2,1],b=[1,0,10,9,8,7,6,5,4,3,2],c=function(a){if(a=$.trim(a),15==a.length)return f(a);if(18==a.length){var b=a.split("");return e(a)&&d(b)}return!1},d=function(c){var d=0;"x"==c[17].toLowerCase()&&(c[17]=10);for(var e=0;17>e;e++)d+=a[e]*c[e];var f=d%11;return c[17]==b[f]},e=function(a){var b=a.substring(6,10),c=a.substring(10,12),d=a.substring(12,14),e=new Date(b,parseFloat(c)-1,parseFloat(d));return!(e.getFullYear()!=parseFloat(b)||e.getMonth()!=parseFloat(c)-1||e.getDate()!=parseFloat(d))},f=function(a){var b=a.substring(6,8),c=a.substring(8,10),d=a.substring(10,12),e=new Date(b,parseFloat(c)-1,parseFloat(d));return!(e.getYear()!=parseFloat(b)||e.getMonth()!=parseFloat(c)-1||e.getDate()!=parseFloat(d))};return c}()]}}(),$.fn.popup=function(){this.modal();var a=this.modal(),b=this;a.on("open",function(){b.trigger("mask-open")}).on("opened",function(){b.trigger("mask-complete")}).on("close",function(){b.trigger("mask-exit")}).on("closed",function(){b.trigger("mask-close")}),this.find(".btn-close").click(function(){a.trigger("close")}),a.open(),b.trigger("mask-open")},$.fn.unmask=function(){var a=this.data("ui-modal");return a&&a.trigger("close"),this},function(){var a=/http:/,b=/[\\/]/,c={base:"http://js.tgimg.cn/jquery/base/",version:"newest",perfix:"jQuery.",suffix:"js",subfix:""};require.defaults.plusin.tg={config:function(){var d=this.url.substr(this.url.lastIndexOf("/")+1);new RegExp("(.)*\\."+c.suffix+"$").test(d)&&(d=this.url.substring(0,this.url.lastIndexOf(".")-1));var e=this.url;if(!a.test(this.url)){var f=this.url.replace(b,"/").substring(0,this.url.lastIndexOf("/"))+"/",g="string"==$.type(c.version)?c.version:c.version[e];g=g?"?v="+g:"",this.url=c.base+f+c.perfix+d+c.subfix+"."+c.suffix+g}this.name=d},callback:require.defaults.plusin.auto.callback},TG.require=function(a,b){return a=a.map(function(a){return"string"==$.type(a)?"tg!"+a:a}),require(a,b)},TG.require.config=function(a){$.extend(d,a)};var d=TG.require.defaults={perfix:"jQuery.",suffix:"js",subfix:"",paths:{}};TG.define=function(a,b,c){return"string"!=typeof a&&(c=b,b=a,a=null),void 0===c&&(c=b,b=[]),$.isArray(b)||(b=[b]),b=b.map(function(a){return"string"==$.type(a)?"tg!"+a:a}),define(b,c)}}(),TG.UI={Flash:{version:$.support.flash,append:function(a,b,c,d,e){return $(TG.UI.Flash.getHTML(b,c,d,e)).appendTo(a)},getHTML:function(a,b,c,d){return"object"==typeof c&&(d=c,c=null),"object"==typeof b&&(d=b,b=null),$.Flash(a,$.extend(d,{width:b,height:c})).toString()}}},function(a){var b={},c=function(c,d,e,f,g){var h,i,j=_.argsFormat(["string,array","function","function","boolean",function(a){return!(!a||!a.done)}],[void 0,function(){},function(){},!0,void 0]);return c=j[0],d=j[1],e=j[2],f=j[3],g=j[4],"string"==typeof c?(f||(c=c+"?v="+(new Date).getTime()),h=void 0===b[c]?b[c]=TG.loadScript(c):b[c],h.then(d,e),g&&h.then(g.resolve,g.reject),h):c instanceof Array?(h=a.Deferred(),i=function(b,g){if(b<c.length){var h=a.Deferred(),i=f;return g.then(function(){TG.jsLoader(c[b],d,e,i,h)},e),arguments.callee(b+1,h)}return g}(1,h),i.then(d,e),arguments.callee(c[0],d,e,f,h),i):void 0};a.extend(TG,{loadScript:function(b,c,d){return a.ajax({url:b,success:c,error:d})},jsLoader:c})}(jQuery),$.fn.bgiframe=function(a,b,c,d){var e=void 0===d?!0:d;return $(this).each(function(){var d=$(this);if(void 0!==a&&d.css({top:b,left:a}).appendTo(c?c:"body"),e){var f=$("iframe.popIframe",d),g=$("div.popIframeMask",d);0==g.length?g=$("<div/>").css({position:"absolute",top:0,left:0,"z-index":"-1"}).prependTo(d).addClass("popIframeMask"):g.prependTo(d),0==f.length&&(f=$("<iframe scrolling='no' frameborder='0'/>").css({position:"absolute",top:0,left:0,"z-index":"-2",opacity:0}).addClass("popIframe").prependTo(d)),f.width(d[0].offsetWidth||d.width()).height(d[0].offsetHeight||d.height()),g.width(d[0].offsetWidth||d.width()).height(d[0].offsetHeight||d.height())}})},function(){function a(a,b,c,d,e,f,g){return{action:a,method:c||"post",target:d,enctype:e||"application/x-www-form-urlencoded",accept:f,"accept-charset":g}}function b(a,b){$("#ajaxFrom").remove();var c=$("<form id='ajaxFrom'/>").toggle(!1).attr(a),d=$("<input type='hidden'/>");if(b instanceof $)c.append(b.clone());else if(b)for(var e in b)c.append(d.clone().attr("name",e).val(b[e]?b[e]:""));return c}function c(a){a.attr("target","ajaxIframe");var b=$("#ajaxIframe").unbind("load");return 0==b.length&&(b=$("<iframe scrolling='no' frameborder='0' id='ajaxIframe' name='ajaxIframe' />").toggle(!1)),$("body").append(b),b}$.extend(TG,{form:{ajax:function(d,e,f){if("string"==typeof d&&"object"==typeof e)d=b(a(d),e);else{if(!$.isFunction(e))return;d=$(d),f=e}d.attr("enctype","multipart/form-data"),d.attr("method","post");var g=c(d);d.submit(),g.bind("load",function(a){var b=a.target,c=(b.contentWindow||b.contentDocument).document,d=c.body?$(c.body).text():null,e=c.XMLDocument||c;$.isFunction(f)&&f(d,e)})},send:function(c,d){"string"==typeof c&&(c=a.apply(this,arguments));var e=b(c,d);e.appendTo("body"),e.submit()},get:function(a,b,c,d,e,f){TG.form.send(a,b,"get",c,d,e,f)},post:function(a,b,c,d,e,f){TG.form.send(a,b,"post",c,d,e,f)},getVal:function(a,b){var c=$();a instanceof Array||(a=[a]);for(var d=0;d<a.length;d++)$.merge(c,$(a[d]));if(0==c.length)return void 0;var e=$("textarea,select,input",c).not(":button,input:not(:checked)");return e=b?e.not(b):e,$.serializeNodes(e,function(a){return 1==a.length?a[0]:void 0})},encode:function(a){var b=typeof a,c=arguments.callee;if(!a||!isNaN(a)||"boolean"==b)return a;if("string"==b)return encodeURIComponent(a);if($.isFunction(a))return c.call(this,a());if(a instanceof Array)for(var d=0;d<a.length;d++)a[d]=c.call(this,a[d]);else if("object"==b)for(var e in a)a[e]=c.call(this,a[e]);return a}}}),$.ajaxForm=TG.form.ajax}();